<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Перенаправление во внешний браузер</title>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <script>
        window.addEventListener('load', function() {
            let redirected = false;

            // Надёжная проверка на Telegram in-app браузер
            const isTelegramInApp = 
                (window.Telegram && window.Telegram.WebApp) ||
                (typeof window.TelegramWebview !== 'undefined') ||
                navigator.userAgent.toLowerCase().includes('telegram');

            if (!isTelegramInApp) {
                // Не в Telegram — показываем обычный контент
                showMainContent();
                return;
            }

            const currentUrl = window.location.href;

            // 1. Хак для Android — самый надёжный в 2025 году
            const ua = navigator.userAgent.toLowerCase();
            const isAndroid = ua.includes('android');

            if (isAndroid) {
                const hostPath = currentUrl.replace(/^https?:\/\//, '');
                const intentUrl = `intent://${hostPath}#Intent;scheme=https;end`;
                window.location.href = intentUrl;
                redirected = true;
            }

            // 2. Для iOS и если Android не сработал — официальный метод
            if (window.Telegram && window.Telegram.WebApp && typeof Telegram.WebApp.openLink === 'function') {
                Telegram.WebApp.openLink(currentUrl);
                redirected = true;
            }

            // Ждём 2 секунды — если не перенаправило, показываем кнопку
            setTimeout(function() {
                if (!redirected || document.visibilityState === 'visible') {
                    showManualButton();
                }
            }, 2000);
        });

        function showManualButton() {
            document.body.innerHTML = `
                <div style="
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                    text-align: center;
                    padding: 40px 20px;
                    background: #f0f0f0;
                    min-height: 100vh;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                ">
                    <h2>Откройте в внешнем браузере</h2>
                    <p>Автоматическое перенаправление не сработало.<br>Нажмите кнопку ниже.</p>
                    <a href="${window.location.href}" target="_blank" rel="noopener" style="
                        display: inline-block;
                        background: #0088cc;
                        color: white;
                        padding: 16px 32px;
                        font-size: 18px;
                        border-radius: 12px;
                        text-decoration: none;
                        margin-top: 20px;
                    ">Открыть во внешнем браузере</a>
                </div>
            `;
        }

        function showMainContent() {
            // Здесь ваш основной контент сайта (если нужно что-то показывать вне Telegram)
            document.body.innerHTML = `
                <div style="text-align:center; padding:50px; font-family:sans-serif;">
                    <h1>Добро пожаловать!</h1>
                    <p>Это ваш сайт. В Telegram вы будете автоматически перенаправлены во внешний браузер.</p>
                </div>
            `;
        }
    </script>
</head>
<body style="margin:0; background:#fff;">
    <div style="text-align:center; padding:50px; font-family:sans-serif; color:#666;">
        <p>Перенаправляем во внешний браузер...</p>
        <p>Подождите пару секунд.</p>
    </div>
</body>
</html>
