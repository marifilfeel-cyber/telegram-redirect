<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Перенаправление во внешний браузер</title>

    <!-- Подключаем официальный скрипт Telegram WebApp (нужен для метода openLink) -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <script>
        // Ждём полной загрузки страницы и скрипта Telegram
        window.addEventListener('load', function() {
            // 1. Пытаемся использовать официальный метод Telegram WebApp (работает на iOS и Android)
            if (window.Telegram && window.Telegram.WebApp && typeof Telegram.WebApp.openLink === 'function') {
                Telegram.WebApp.openLink(window.location.href, { try_instant_view: false });
                return;
            }

            // 2. Дополнительный хак для Android (Intent URL) — если первый способ не сработал
            const ua = navigator.userAgent.toLowerCase();
            const isAndroid = ua.includes('android');
            const isTelegramInApp = ua.includes('telegram') || window.TelegramWebview;

            if (isAndroid && isTelegramInApp) {
                const currentUrl = window.location.href;
                // Убираем протокол http/https
                const hostPath = currentUrl.replace(/^https?:\/\//, '');
                const intentUrl = `intent://${hostPath}#Intent;scheme=https;package=com.android.chrome;end`;

                // Пытаемся открыть через intent
                window.location.href = intentUrl;

                // Если через 1 секунду не перенаправило — покажем кнопку ручного открытия
                setTimeout(showManualButton, 1000);
                return;
            }

            // Если ничего не сработало — показываем кнопку
            showManualButton();
        });

        // Функция для показа кнопки ручного открытия во внешнем браузере
        function showManualButton() {
            document.body.innerHTML = `
                <div style="
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                    text-align: center;
                    padding: 40px 20px;
                    background: #f0f0f0;
                    min-height: 100vh;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                ">
                    <h2>Откройте в браузере</h2>
                    <p>Telegram блокирует автоматическое открытие.<br>Нажмите кнопку ниже, чтобы продолжить во внешнем браузере.</p>
                    <a href="${window.location.href}" target="_blank" rel="noopener" style="
                        display: inline-block;
                        background: #0088cc;
                        color: white;
                        padding: 14px 28px;
                        font-size: 18px;
                        border-radius: 8px;
                        text-decoration: none;
                        margin-top: 20px;
                    ">Открыть во внешнем браузере</a>
                </div>
            `;
        }
    </script>
</head>
<body style="margin:0; background:#fff;">
    <!-- Можно добавить лоадер или сообщение, пока идёт перенаправление -->
    <div style="text-align:center; padding:50px; font-family:sans-serif; color:#666;">
        <p>Перенаправляем во внешний браузер...</p>
    </div>
</body>
</html>
